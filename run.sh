#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÑƒ Ð±Ð¾Ñ‚Ð° Ð´Ð»Ñ Linux

# ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ñ–ÑŽ Ð±Ð¾Ñ‚Ð°
cd "$(dirname "$0")"

# Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ñ–ÑŽ Ð´Ð»Ñ Ð»Ð¾Ð³Ñ–Ð²
mkdir -p logs

# ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸ Ð½Ð°ÑÐ²Ð½Ñ–ÑÑ‚ÑŒ Ð²Ñ–Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð¾Ñ‡ÐµÐ½Ð½Ñ
if [ -d "venv" ]; then
    echo "ðŸ”§ ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ñ–Ñ Ð²Ñ–Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð¾Ñ‡ÐµÐ½Ð½Ñ..."
    source venv/bin/activate
else
    echo "âš ï¸ Ð’Ñ–Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ðµ Ð¾Ñ‚Ð¾Ñ‡ÐµÐ½Ð½Ñ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾"
    echo "ðŸ“¦ Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð² Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ðµ Ð¾Ñ‚Ð¾Ñ‡ÐµÐ½Ð½Ñ..."
    pip install -r requirements.txt
fi

# ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸ Ð½Ð°ÑÐ²Ð½Ñ–ÑÑ‚ÑŒ .env Ñ„Ð°Ð¹Ð»Ñƒ
if [ ! -f ".env" ]; then
    echo "âš ï¸ Ð¤Ð°Ð¹Ð» .env Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾"
    echo "ðŸ“ Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ .env Ð· Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ñƒ..."
    if [ -f ".env.example" ]; then
        cp .env.example .env
        echo "âœï¸ Ð’Ñ–Ð´Ñ€ÐµÐ´Ð°Ð³ÑƒÐ¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» .env Ñ‚Ð° Ð·Ð°Ð¿ÑƒÑÑ‚Ñ–Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð° Ð·Ð½Ð¾Ð²Ñƒ"
        exit 1
    else
        echo "âŒ Ð¤Ð°Ð¹Ð» .env.example Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾"
        exit 1
    fi
fi

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð±Ð¾Ñ‚Ð°
echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°..."
echo "ðŸ“ Ð›Ð¾Ð³Ð¸ Ð±ÑƒÐ´ÑƒÑ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑƒÐ²Ð°Ñ‚Ð¸ÑÑŒ Ð² logs/bot.log"
echo "ðŸ”„ Ð”Ð»Ñ Ð·ÑƒÐ¿Ð¸Ð½ÐºÐ¸ Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ctrl+C"

# Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð° Ð· Ð¿ÐµÑ€ÐµÐ½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½ÑÐ¼ Ð²Ð¸Ð²Ð¾Ð´Ñƒ
python main.py 2>&1 | tee -a logs/bot_console.log
